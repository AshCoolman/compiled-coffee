// Generated by CoffeeScript 1.3.3
(function() {
  var Builder, assert, glob, go, main, params, suspend;

  Builder = require('./ccoffee/builder.generators');

  params = require('commander');

  glob = require('glob');

  suspend = require('suspend');

  go = suspend.resume;

  assert = require('assert');

  params.version('0.1.0').usage('-i <src> -o <build>').option('-i, --source-dir <dir>', 'Input directory for source files').option('-o, --build-dir <dir>', 'Output directory for built files').option('-p, --pack <FILE:MODULE_NAME>', 'Creates a CJS browserify package').option('-w, --watch', 'Watch for source files changes').parse(process.argv);

  if (!params.sourceDir || !params.buildDir) {
    return params.help();
  }

  main = suspend(function*() {
    var builder, files;
    files = yield glob('**/*.coffee', {
      cwd: params.sourceDir
    }, go());
    assert(files.length, "No files to precess found");
    builder = new Builder(files, params.sourceDir, params.buildDir, params.pack);
    if (params.watch) {
      return yield builder.watch(go());
    } else {
      yield builder.build(go());
      return console.log("Compilation completed");
    }
  });

  main();

  /*
  TODO
    var files input
  	watch files
    watch definitions
    flowless restart (clock)
    ...
    typescript service integration? (via memory, not just files)
    merge command line tools directly to this event loop
    watch changes throttling support
  */


}).call(this);
